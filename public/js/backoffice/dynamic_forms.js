"use strict";class DynamicFormObserver{rowWasCreated(e){}rowWasRemoved(e){}}class DynamicForms{constructor(){this.dynamic_elements={},this.templates={},this.observers=[]}addObserver(e){this.observers.push(e)}rowWasRemoved(e){for(let t in this.observers){let a=this.observers[t];void 0!==a.rowWasRemoved&&"function"==typeof a.rowWasRemoved?a.rowWasRemoved(e):console.log('[-] DynamicForms: observer function missing "rowWasRemoved"')}}rowWasCreated(e){for(let t in this.observers){let a=this.observers[t];void 0!==a.rowWasCreated&&"function"==typeof a.rowWasCreated?a.rowWasCreated(e):console.log('[-] DynamicForms: observer function missing "rowWasCreated"')}}automaticallySetupForm(){$("[data-dynamic-form] [data-dynamic-form-template]").each(function(e,t){let a=$(t),i=a.parent();this.setupForm(i,a)}.bind(this))}setupForm(e,t){t.detach();let a=t.data("dynamic-form-fill");if(void 0===a)this.createNewRow(e,t);else if("string"!=typeof a)for(let i in a)a.hasOwnProperty(i)&&this.createNewRow(e,t,i,a[i]);else this.createNewRow(e,t);DynamicForms.handleButtons(e)}createNewRow(e,t,a,i){let o=t.clone(),n=t.data("dynamic-form-template"),r=DynamicForms.deepValues(i);void 0===this.templates[n]?this.templates[n]=0:this.templates[n]++;let s,m=this.templates[n];o.removeAttr("data-dynamic-form-template"),o.removeAttr("data-dynamic-form-fill"),o.find("[data-dynamic-form-input-id-template]").each(function(e,t){let i=$(t),o=i.attr("name");s=void 0===this.dynamic_elements[o];let n,m=i.data("dynamic-form-input-id-template");if(void 0!==r){let e=i.data("dynamic-form-input-name");"string"==typeof r?i.val(r):"object"==typeof r&&r.hasOwnProperty(e)&&i.val(r[e])}void 0===a?(void 0===this.dynamic_elements[o]?this.dynamic_elements[o]=0:this.dynamic_elements[o]++,n=o.replace(m,DynamicForms.numToChar(this.dynamic_elements[o]))):n=o.replace(m,a),i.attr("name",n)}.bind(this)),o.find("[data-dynamic-form-add]").each(function(a,i){let o=$(i);o.attr("data-dynamic-form-add",DynamicForms.getDataTagForButton(n,"add",m)),o.click(function(){this.createNewRow(e,t),DynamicForms.handleButtons(e)}.bind(this))}.bind(this)),o.find("[data-dynamic-form-remove]").each(function(t,i){let r=$(i);r.attr("data-dynamic-form-remove",DynamicForms.getDataTagForButton(n,"remove",m)),r.click(function(){o.remove(),DynamicForms.handleButtons(e),DynamicForms.updateRemoveField(e,n,a),this.rowWasRemoved(o)}.bind(this))}.bind(this)),o.show(),o.appendTo(e),this.rowWasCreated(o)}static updateRemoveField(e,t,a){if(!isNaN(parseInt(a))&&isFinite(a))if(0===e.find("input[type='hidden']").length)e.prepend('<input type="hidden" name="remove_'+t+'" value="'+a+'" />');else{let t=$(e.find("input[type='hidden']")[0]),i=t.val();t.val(i+","+a)}}static getDataTagForButton(e,t,a){return e+"-"+t+"-"+a}static handleButtons(e){e.find("[data-dynamic-form-add]").each(function(e,t){$(t).hide()}),e.find("[data-dynamic-form-add]").last().show(),e.find("[data-dynamic-form-remove]").each(function(e,t){$(t).show()}),e.find("[data-dynamic-form-remove]").last().show()}static numToChar(e){let t="abcdefghijklmnopqrstuvwxyz",a="";for(e++;e>0;){let i=--e%t.length;a=t[i]+a,e=(e-i)/t.length}return a}static deepValues(e){if(void 0===e||"string"==typeof e)return e;let t={};for(let a in e)if(e.hasOwnProperty(a))if("string"==typeof e[a]||"number"==typeof e[a])t[a]=e[a];else if("object"==typeof e[a]){let i=DynamicForms.deepValues(e[a]);for(let e in i)if(i.hasOwnProperty(e)){t[a+"."+e]=i[e]}}return t}}window.DynamicForms=DynamicForms,window.DynamicFormObserver=DynamicFormObserver;
;